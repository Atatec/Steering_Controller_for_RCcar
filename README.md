# Steering_Controller_for_RCcar
How to make the steering controller for RC car
ラジコンカー用ステアリングコントローラー製作
<br>
(執筆中。少しずつ更新していく予定)
## 概要
* ラジコンカーを市販のゲーム用ステアリングコントローラーで操作できるようにする。
* ステアリングコントローラーをプロポに接続するためのアダプターを制作。
* 対応機器は以下。対応機器以外はパラメータ調整が必要。
    * プロポ　ファインスペック2.4G
    * ステアリングコントローラ　Logicool

## システム概要

### ステアリング制御
<br>

1. ステアリングコントローラーが出力するエンコーダパルスをarduinoへ入力し、ステアリング現在位置を取得。
2. ステアリング現在位置をプロポの電圧レンジに変換する。
3. 変換値をarduinoからDAコンバータ（mcp4726）へI2Cで送信する。
4. DAコンバータで生成したアナログ電圧をプロポへ入力する。

### アクセル制御
<br>

1. ステアリングコントローラーのアクセルペダル、及びブレーキペダルのアナログ電圧をarduinoへ入力し、ペダル踏み込み量を取得。
2. ペダル踏み込み量をプロポの電圧レンジに変換する。
3. 変換値をarduinoからDAコンバータ（mcp4726）へI2Cで送信する。
4. DAコンバータて生成したアナログ電圧をプロポへ入力する。

### 回路図
電源は9v,5v,3.3vを使い分けているため注意のこと。
<br>
![回路図](./circuit_diagram.PNG)

## 使用アイテム
* RCカー：1/10スケール　タミヤ　コミカルマイティフロッグ
* プロポ：fine spec 2.4G
* ステアリングコントローラー：Logicool
* arduino uno ×２個
* DAコンバータ　×２個
* カーボン抵抗　×２個
* セラミックコンデンサ　×２個
* D-sub9ピンコネクタ


## 製作手順
### プロポに入力信号線の増設
1. プロポを分解し、ステアリングとアクセルコントロール用のポテンショメータを取り外す。プロポにもよるが、基盤に直接3点止めで半田付けされているため、半田吸引器が必須。
2. ポテンショメータを外した基盤側に信号線をそれぞれ一本とアース線を合計三本半田付けする。
### ステアリングコントローラに出力信号線の増設
* ステアリング信号
    1. エンコーダの仕様を確認する。4線であれば、おそらくA相、B相、電源、グランドの組合せ。わからなければ、オシロスコープで組合せを確認し、パルス変化があった線をロジックアナライザで分析する。
    2. 4線を基盤に刺さず、そのまま信号線として使用する。
* アクセル信号
    1. アクセル、ブレーキ用にそれぞれポテンショメータが設置されており、電源線(共有)、アース線(共有)、出力電圧線の合計４本を増設する。
### 変換基盤の製作
* 回路図を元に変換基盤を製作する。
* 基盤の電源は9v。
## パラメータ調整
変換後出力電圧が下表のプロポ電圧になるよう、
ソースコードのパラメータを調整する。
パソコンに接続してシリアルモニタで電圧値を確認しながら調整するが、
パソコンからのUSB給電時と
実際の外部電源を使用した時とでは電圧降下量が違うため、
外部電源使用時に目標電圧になるようパラメータを調整する。
下表の電圧になるよう、ソースコードのパラメータ変更を繰り返し実施する。

### プロポの電圧
#### フットペダル
|  | OFF | ON |
| ---- | ---- | ---- |
| アクセル | 1.787v | 0.999v |
| ブレーキ | 1.787v | 2.406v |

#### ステアリング

|  | 左max | 中央 | 右max  |
| ---- | ---- | ---- | ---- |
| ステアリング | 2.770v | 1.694v | 0.547v |

### ステアリングコントローラ

#### フットペダル
|  | OFF | ON |
| ---- | ---- | ---- |
| アクセル | 2.803v | 0.280v |
| ブレーキ | 0.480v | 3.080v |

#### ステアリング

|  | 左max | 中央 | 右max  |
| ---- | ---- | ---- | ---- |
| ステアリング | 2.907v | 1.972v | 1.110v |
